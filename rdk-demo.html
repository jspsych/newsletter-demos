<!DOCTYPE html>
<html>
  <head>
    <title>Random Dot Kinematogram Demo</title>
    <script src="https://unpkg.com/jspsych@8.0.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-rdk@2.0.0"></script>
    <link href="https://unpkg.com/jspsych@8.0.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>
    const jsPsych = initJsPsych({
      on_finish: function(){
        jsPsych.data.displayData();
      }
    });

    var timeline = [];

    const introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                You're about to get a quick demo of jsPsych's Random Dot Kinematogram plugin!
            </h3>
            <p style='padding: 0 8em;'> 
                The demo will walk you through a few parameters in the plugin.</p>
        `,
        prompt: "<p>Press any key to continue from each screen</p>"
    }

    const exit = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                This concludes the demo!</h3>
            <p style='padding: 0 8em;'>
                Thanks for your time! You can also see the data recorded from each RDK trial on exiting this screen.</p>
        `,
        prompt: "<p>Press any key to see data and end the demo.</p>"
    }

    const coherence_introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                The first parameter we'll look at is "coherence."</h3>
            <p style='padding: 0 8em;'>
                This determines the proportion of dots assigned as signal dots</p>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const coherence_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: () => `
            <h3 style='padding: 0 8em;'>
                The next screen has coherence set to ${jsPsych.evaluateTimelineVariable('coherence')}.
            </h3>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const coherence = {
        type: jsPsychRdk,
        choices: "ALL_KEYS",
        correct_choice: "ALL_KEYS",
        trial_duration: -1,
        coherence: jsPsych.timelineVariable('coherence'),
    }

    const rdk_type_introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                This last parameter, "RDK_type," most dramatically influences the RDK's behavior.</h3>
            <p style='padding: 0 8em;'>
                It takes values between 1 and 6.</p>
            <p style='padding: 0 8em;'> 
                Each determines (1) if signal dot assignments change, and (2) how noise dots behave.</p>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const rdk_type_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: () => `
            <h3 style='padding: 0 8em;'>
                The next screen has RDK_type set to ${jsPsych.evaluateTimelineVariable('RDK_type')}</h3>
            <p style='padding: 0 8em;'> 
                (1) Signal dot assignments ${jsPsych.evaluateTimelineVariable('signal')}</p>
            <p style='padding: 0 8em;'>
                (2) Noise dots ${jsPsych.evaluateTimelineVariable('noise')}.</p>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const rdk_type = {
        type: jsPsychRdk,
        choices: "ALL_KEYS",
        correct_choice: "ALL_KEYS",
        trial_duration: -1,
        RDK_type: jsPsych.timelineVariable('RDK_type'),
    }

    const direction_introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                Next, we'll demo the direction parameter</h3>
            <p style='padding: 0 8em;'>
                This parameter is specified in degrees. 0 degrees points to the right,
                and each degree shifts the direction counterclockwise.</p>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const direction_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: () => `
            <h3 style='padding: 0 8em;'>
                The next screen has direction set to ${jsPsych.evaluateTimelineVariable('coherent_direction')},
                or ${jsPsych.evaluateTimelineVariable('direction')}.
            </h3>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const direction = {
        type: jsPsychRdk,
        choices: "ALL_KEYS",
        correct_choice: "ALL_KEYS",
        trial_duration: -1,
        coherent_direction: jsPsych.timelineVariable('coherent_direction'),
    }

    const opposite_introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h3 style='padding: 0 8em;'>
                Next, we'll demo the "opposite_coherence" parameter.</h3>
            <p style='padding: 0 8em;'>
                This sets the proportion of dots moving opposite to the signal dots.</p>
            <p style='padding: 0 8em;'> This parameter is relative to the total number of dots, not the amount of signal or noise dots. 
                For instance, an opposite coherence of 0.1 will affect 30 out of 300 dots in an RDK of 
                coherence 0.5, rather than 15 out of 150 noise dots.</p>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const opposite_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: () => `
            <h3 style='padding: 0 8em;'>
                The next screen has opposite_coherence set to ${jsPsych.evaluateTimelineVariable('opposite_coherence')}.
            </h3>
        `,
        prompt: "<p>Press any key to continue.</p>"
    }
    const opposite = {
        type: jsPsychRdk,
        choices: "ALL_KEYS",
        correct_choice: "ALL_KEYS",
        trial_duration: -1,
        opposite_coherence: jsPsych.timelineVariable('opposite_coherence'),
    }

    const coherence_screens = {
        timeline: [coherence_instructions, coherence],
        timeline_variables: [
            { coherence: 0 },
            { coherence: 0.1 },
            { coherence: 0.5 },
        ]
    }
    const coherence_demo = {
        timeline: [coherence_introduction, coherence_screens]
    }
    const rdk_type_screens = {
        timeline: [rdk_type_instructions, rdk_type],
        timeline_variables: [{ 
                RDK_type: 1, 
                signal: 'do not change each frame',
                noise: 'change location each frame'
            },{ 
                RDK_type: 2, 
                signal: 'do not change each frame',
                noise: 'change direction each frame'
            },{ 
                RDK_type: 3, 
                signal: 'do not change each frame',
                noise: 'keep direction across frames'
            },{ 
                RDK_type: 4, 
                signal: 'change each frame',
                noise: 'change locations each frame'
            },{ 
                RDK_type: 5, 
                signal: 'change each frame',
                noise: 'change direction each frame' 
            },{ 
                RDK_type: 6, 
                signal: 'change each frame',
                noise: 'keep direction across frames'
            },
        ]
    }
    const rdk_type_demo = {
        timeline: [rdk_type_introduction, rdk_type_screens]
    }
    const direction_screens = {
        timeline: [direction_instructions, direction],
        timeline_variables: [
            { coherent_direction: 0, direction: 'to the right' },
            { coherent_direction: 90, direction: 'straight up' },
            { coherent_direction: 180, direction: 'to the left'},
        ]
    }
    const direction_demo = {
        timeline: [direction_introduction, direction_screens]
    }
    const opposite_screens = {
        timeline: [opposite_instructions, opposite],
        timeline_variables: [
            { opposite_coherence: 0 },
            { opposite_coherence: 0.1 },
            { opposite_coherence: 0.5 },
        ]
    }
    const opposite_demo = {
        timeline: [opposite_introduction, opposite_screens]
    }

    timeline.push(introduction, coherence_demo, direction_demo, opposite_demo, rdk_type_demo, exit);

    jsPsych.run([timeline]);
  </script>
</html>
